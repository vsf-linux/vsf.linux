# CMakeLists head

cmake_policy(SET CMP0079 NEW)

file(GLOB_RECURSE BUSYBOX_SOURCES
    port/vsf_porting/libbb_dynlib.c

    raw/archival/libarchive/decompress_bunzip2.c
    raw/archival/libarchive/open_transformer.c
    raw/archival/bbunzip.c
#    raw/archival/libarchive/common.c
#    raw/archival/libarchive/data_align.c
#    raw/archival/libarchive/data_extract_all.c
#    raw/archival/libarchive/data_extract_to_command.c
#    raw/archival/libarchive/data_extract_to_stdout.c
#    raw/archival/libarchive/data_skip.c
#    raw/archival/libarchive/decompress_gunzip.c
#    raw/archival/libarchive/decompress_uncompress.c
#    raw/archival/libarchive/decompress_unlzma.c
#    raw/archival/libarchive/decompress_unxz.c
#    raw/archival/libarchive/filter_accept_all.c
#    raw/archival/libarchive/filter_accept_list.c
#    raw/archival/libarchive/filter_accept_list_reassign.c
#    raw/archival/libarchive/filter_accept_reject_list.c
#    raw/archival/libarchive/find_list_entry.c
#    raw/archival/libarchive/get_header_ar.c
#    raw/archival/libarchive/get_header_cpio.c
#    raw/archival/libarchive/get_header_tar.c
#    raw/archival/libarchive/get_header_tar_bz2.c
#    raw/archival/libarchive/get_header_tar_gz.c
#    raw/archival/libarchive/get_header_tar_lzma.c
#    raw/archival/libarchive/get_header_tar_xz.c
#    raw/archival/libarchive/header_list.c
#    raw/archival/libarchive/header_skip.c
#    raw/archival/libarchive/header_verbose_list.c
#    raw/archival/libarchive/init_handle.c
#    raw/archival/libarchive/lzo1x_1.c
#    raw/archival/libarchive/lzo1x_1o.c
#    raw/archival/libarchive/lzo1x_9x.c
#    raw/archival/libarchive/lzo1x_d.c
#    raw/archival/libarchive/seek_by_jump.c
#    raw/archival/libarchive/seek_by_read.c
#    raw/archival/libarchive/unpack_ar_archive.c
#    raw/archival/libarchive/unsafe_prefix.c
#    raw/archival/libarchive/unsafe_symlink_target.c
#    raw/archival/ar.c
#    raw/archival/bzip2.c
#    raw/archival/chksum_and_xwrite_tar_header.c
#    raw/archival/cpio.c
#    raw/archival/dpkg.c
#    raw/archival/dpkg_deb.c
#    raw/archival/gzip.c
#    raw/archival/lzop.c
#    raw/archival/rpm.c
#    raw/archival/tar.c
#    raw/archival/unzip.c

    raw/console-tools/chvt.c
    raw/console-tools/clear.c
    raw/console-tools/deallocvt.c
    raw/console-tools/dumpkmap.c
    raw/console-tools/fgconsole.c
    raw/console-tools/kbd_mode.c
    raw/console-tools/loadkmap.c
    raw/console-tools/reset.c
    raw/console-tools/setkeycodes.c
    raw/console-tools/showkey.c

    raw/coreutils/libcoreutils/cp_mv_stat.c
    raw/coreutils/libcoreutils/getopt_mk_fifo_nod.c
    raw/coreutils/basename.c
    raw/coreutils/cat.c
    raw/coreutils/chgrp.c
    raw/coreutils/chmod.c
    raw/coreutils/chown.c
    raw/coreutils/chroot.c
    raw/coreutils/cksum.c
    raw/coreutils/comm.c
    raw/coreutils/cp.c
    raw/coreutils/cut.c
    raw/coreutils/date.c
    raw/coreutils/dd.c
    raw/coreutils/df.c
    raw/coreutils/dirname.c
    raw/coreutils/dos2unix.c
    raw/coreutils/du.c
    raw/coreutils/echo.c
    raw/coreutils/env.c
    raw/coreutils/expand.c
    raw/coreutils/expr.c
    raw/coreutils/factor.c
    raw/coreutils/false.c
    raw/coreutils/fold.c
    raw/coreutils/head.c
    raw/coreutils/hostid.c
    raw/coreutils/install.c
    raw/coreutils/link.c
    raw/coreutils/ln.c
    raw/coreutils/logname.c
    raw/coreutils/ls.c
    raw/coreutils/md5_sha1_sum.c
    raw/coreutils/mkdir.c
    raw/coreutils/mkfifo.c
    raw/coreutils/mknod.c
    raw/coreutils/mktemp.c
    raw/coreutils/mv.c
    raw/coreutils/nl.c
    raw/coreutils/nohup.c
    raw/coreutils/od.c
    raw/coreutils/paste.c
    raw/coreutils/printenv.c
    raw/coreutils/printf.c
    raw/coreutils/pwd.c
    raw/coreutils/readlink.c
    raw/coreutils/realpath.c
    raw/coreutils/rm.c
    raw/coreutils/rmdir.c
    raw/coreutils/seq.c
    raw/coreutils/shred.c
    raw/coreutils/shuf.c
    raw/coreutils/sleep.c
    raw/coreutils/sort.c
    raw/coreutils/split.c
    raw/coreutils/stat.c
    raw/coreutils/stty.c
    raw/coreutils/sum.c
    raw/coreutils/sync.c
    raw/coreutils/tac.c
    raw/coreutils/tail.c
    raw/coreutils/tee.c
    raw/coreutils/test.c
    raw/coreutils/test_ptr_hack.c
    raw/coreutils/timeout.c
    raw/coreutils/touch.c
    raw/coreutils/tr.c
    raw/coreutils/true.c
    raw/coreutils/truncate.c
    raw/coreutils/tsort.c
    raw/coreutils/tty.c
    raw/coreutils/uname.c
    raw/coreutils/uniq.c
    raw/coreutils/unlink.c
    raw/coreutils/usleep.c
    raw/coreutils/uudecode.c
    raw/coreutils/uuencode.c
    raw/coreutils/wc.c
    raw/coreutils/whoami.c
    raw/coreutils/yes.c

    raw/editors/awk.c
    raw/editors/cmp.c
    raw/editors/diff.c
    raw/editors/ed.c
    raw/editors/patch.c
    raw/editors/sed.c
    raw/editors/vi.c

    raw/findutils/find.c
    raw/findutils/grep.c
    raw/findutils/xargs.c

    raw/init/bootchartd.c
    raw/init/halt.c
    raw/init/init.c

    raw/libpwdgrp/uidgid_get.c

    raw/miscutils/ascii.c
    raw/miscutils/bc.c
    raw/miscutils/chat.c
    raw/miscutils/devmem.c
    raw/miscutils/fbsplash.c
    raw/miscutils/hexedit.c
    raw/miscutils/i2c_tools.c
    raw/miscutils/less.c
    raw/miscutils/lsscsi.c
    raw/miscutils/man.c
    raw/miscutils/microcom.c
    raw/miscutils/partprobe.c
    raw/miscutils/rx.c
    raw/miscutils/setserial.c
    raw/miscutils/strings.c
    raw/miscutils/tree.c
    raw/miscutils/ts.c
    raw/miscutils/ttysize.c
    raw/miscutils/volname.c

    raw/shell/cttyhack.c
    raw/shell/hush.c
    raw/shell/match.c
    raw/shell/math.c
    raw/shell/random.c
    raw/shell/shell_common.c

    raw/libbb/appletlib.c
    raw/libbb/ask_confirmation.c
    raw/libbb/auto_string.c
    raw/libbb/bb_askpass.c
    raw/libbb/bb_bswap_64.c
    raw/libbb/bb_cat.c
    raw/libbb/bb_do_delay.c
    raw/libbb/bb_getgroups.c
    raw/libbb/bb_getsockname.c
    raw/libbb/bb_pwd.c
    raw/libbb/bb_qsort.c
    raw/libbb/bb_strtod.c
    raw/libbb/bb_strtonum.c
    raw/libbb/bbunit.c
    raw/libbb/chomp.c
    raw/libbb/common_bufsiz.c
    raw/libbb/compare_string_array.c
    raw/libbb/concat_path_file.c
    raw/libbb/concat_subpath_file.c
    raw/libbb/const_hack.c
    raw/libbb/copy_file.c
    raw/libbb/copyfd.c
    raw/libbb/correct_password.c
    raw/libbb/crc32.c
    raw/libbb/default_error_retval.c
    raw/libbb/device_open.c
    raw/libbb/dump.c
    raw/libbb/duration.c
    raw/libbb/endofname.c
    raw/libbb/executable.c
    raw/libbb/fclose_nonstdin.c
    raw/libbb/fflush_stdout_and_exit.c
    raw/libbb/fgets_str.c
    raw/libbb/find_mount_point.c
    raw/libbb/find_pid_by_name.c
    raw/libbb/find_root_device.c
    raw/libbb/full_write.c
    raw/libbb/get_console.c
    raw/libbb/get_cpu_count.c
    raw/libbb/get_last_path_component.c
    raw/libbb/get_line_from_file.c
    raw/libbb/get_shell_name.c
    raw/libbb/get_volsize.c
    raw/libbb/getopt_allopts.c
    raw/libbb/getopt32.c
    raw/libbb/getpty.c
    raw/libbb/hash_md5_sha.c
    raw/libbb/herror_msg.c
    raw/libbb/human_readable.c
    raw/libbb/in_ether.c
    raw/libbb/inet_cksum.c
    raw/libbb/inet_common.c
    raw/libbb/inode_hash.c
    raw/libbb/isdirectory.c
    raw/libbb/isqrt.c
    raw/libbb/iterate_on_dir.c
    raw/libbb/kernel_version.c
    raw/libbb/last_char_is.c
    raw/libbb/lineedit.c
    raw/libbb/lineedit_ptr_hack.c
    raw/libbb/llist.c
    raw/libbb/logenv.c
    raw/libbb/login.c
    raw/libbb/loop.c
    raw/libbb/make_directory.c
    raw/libbb/makedev.c
    raw/libbb/match_fstype.c
    raw/libbb/messages.c
    raw/libbb/missing_syscalls.c
    raw/libbb/mode_string.c
    raw/libbb/mtab.c
    raw/libbb/nuke_str.c
    raw/libbb/obscure.c
    raw/libbb/parse_config.c
    raw/libbb/parse_mode.c
    raw/libbb/percent_decode.c
    raw/libbb/perror_msg.c
    raw/libbb/perror_nomsg.c
    raw/libbb/perror_nomsg_and_die.c
    raw/libbb/pidfile.c
    raw/libbb/platform.c
    raw/libbb/print_flags.c
    raw/libbb/print_numbered_lines.c
    raw/libbb/printable.c
    raw/libbb/printable_string.c
    raw/libbb/process_escape_sequence.c
    raw/libbb/procps.c
    raw/libbb/progress.c
    raw/libbb/ptr_to_globals.c
    raw/libbb/pw_encrypt.c
    raw/libbb/read.c
    raw/libbb/read_key.c
    raw/libbb/read_printf.c
    raw/libbb/recursive_action.c
    raw/libbb/remove_file.c
    raw/libbb/replace.c
    raw/libbb/rtc.c
    raw/libbb/run_shell.c
    raw/libbb/safe_gethostname.c
    raw/libbb/safe_poll.c
    raw/libbb/safe_strncpy.c
    raw/libbb/safe_write.c
    raw/libbb/securetty.c
    raw/libbb/setup_environment.c
    raw/libbb/signals.c
    raw/libbb/simplify_path.c
    raw/libbb/single_argv.c
    raw/libbb/skip_whitespace.c
    raw/libbb/speed_table.c
    raw/libbb/str_tolower.c
    raw/libbb/strrstr.c
    raw/libbb/sysconf.c
    raw/libbb/time.c
    raw/libbb/trim.c
    raw/libbb/u_signal_names.c
    raw/libbb/ubi.c
    raw/libbb/udp_io.c
    raw/libbb/update_passwd.c
    raw/libbb/uuencode.c
    raw/libbb/verror_msg.c
    raw/libbb/vfork_daemon_rexec.c
    raw/libbb/warn_ignoring_args.c
    raw/libbb/wfopen.c
    raw/libbb/wfopen_input.c
    raw/libbb/write.c
    raw/libbb/xatonum.c
    raw/libbb/xconnect.c
    raw/libbb/xfunc_die.c
    raw/libbb/xfuncs.c
    raw/libbb/xfuncs_printf.c
    raw/libbb/xgetcwd.c
    raw/libbb/zgethostbyname.c
    raw/libbb/xreadlink.c
    raw/libbb/xrealloc_vector.c
    raw/libbb/xregcomp.c
)
add_library(libbusybox STATIC
    ${BUSYBOX_SOURCES}
)
target_compile_definitions(libbusybox PRIVATE
    ${VSF_TARGET_DEFINITIONS}
    "main=lbb_main"
    "BB_VER=\"1.37.0.git\""
    "ENABLE_USE_BB_CRYPT=1"
    __VSF__
)
target_include_directories(libbusybox PRIVATE
    port
    port/vsf_porting
    raw/include

    ${VSF_COMMON_INCLUDE_DIRECTORIES}
    $ENV{VSF_PATH}/source/shell/sys/linux/include
)
if(VSF_LINUX_USE_SIMPLE_LIBC)
target_include_directories(libbusybox PRIVATE
    $ENV{VSF_PATH}/source/shell/sys/linux/include/simple_libc
)
endif()
if(VSF_TARGET_WRAPPER_LIST)
    foreach(api ${VSF_TARGET_WRAPPER_LIST})
        target_compile_definitions(libbusybox PRIVATE
            "${api}=__wrap_${api}"
        )
    endforeach()
endif()


target_include_directories(${VSF_LIB_NAME} INTERFACE
    raw/include
    ${VSF_MBEDTLS_PATH}/include
)
link_directories(${CMAKE_CURRENT_BINARY_DIR}/libbusybox_bin)
target_link_libraries(${VSF_LIB_NAME} INTERFACE
    libbusybox
)
target_compile_definitions(${VSF_LIB_NAME} INTERFACE
    APP_USE_LINUX_BUSYBOX_DEMO=ENABLED
)
